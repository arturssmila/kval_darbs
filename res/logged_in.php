<?php 	$hom = "http://$_SERVER[HTTP_HOST]";	//var_dump($_SESSION["user"]);	//exit();	if (empty($_SESSION["user"])){//redirect to home if not logged in		header("Location: $hom");	}	$data["manager"] = array();		get_user("S", array("id"=>$_SESSION["user"]["id"]), $curr_user);	$original_link = str_replace("/", "", $data["cat"][0]["long_link"]);	if(($curr_user[0]["admin"] == 1) || ($curr_user[0]["admin"] == 2)){		if($curr_user[0]["admin"] == 2){			if(empty($curr_user[0]["manager"])){				header("Location: $hom");			}		}		if(!empty($curr_user[0]["translator"]) || !empty($curr_user[0]["editor"])){			$data["routes"] = array(//array of manager page menu items				"0" => array(					"name" => "new_projects",					"lg" => $data["lg"]["new_projects"],					"url" => url($original_link, "0")				),				"1" => array(					"name" => "trash",					"lg" => $data["lg"]["trash"],					"url" => url($original_link, "1")				),				"2" => array(					"name" => "waiting_approval",					"lg" => $data["lg"]["waiting_approval"],					"url" => url($original_link, "2")				),				"3" => array(					"name" => "needs_employees",					"lg" => $data["lg"]["needs_employees"],					"url" => url($original_link, "3")				),				"4" => array(					"name" => "in_execution",					"lg" => $data["lg"]["in_execution"],					"url" => url($original_link, "4")				),				"5" => array(					"name" => "completed",					"lg" => $data["lg"]["completed"],					"url" => url($original_link, "5"),					"hidden" => true				),				"6" => array(					"name" => "transfered",					"lg" => $data["lg"]["transfered"],					"url" => url($original_link, "6")				),				"7" => array(					"name" => "new_jobs",					"lg" => $data["lg"]["new_jobs"],					"url" => url($original_link, "7")				),				"8" => array(					"name" => "in_progress",					"lg" => $data["lg"]["in_progress"],					"url" => url($original_link, "8")				),				"9" => array(					"name" => "completed_jobs",					"lg" => $data["lg"]["completed_jobs"],					"url" => url($original_link, "9")				),				"10" => array(					"name" => "declined",					"lg" => $data["lg"]["declined"],					"url" => url($original_link, "10")				),				"11" => array(					"name" => "clients",					"lg" => $data["lg"]["clients"],					"pending" => "0",					"url" => url($original_link, "7")				),				"12" => array(					"name" => "registration_requests",					"lg" => $data["lg"]["registration_requests"],					"pending" => resetRegistrationNotifications(),					"url" => url($original_link, "8")				),				"13" => array(					"name" => "employees",					"lg" => $data["lg"]["employees"],					"url" => url($original_link, "9") ,					"hidden" => true				)/*"http://$_SERVER[HTTP_HOST]" . $data['cat'][0]['long_link'] . "/6"*/			);			//$data["routes"][12]["pending"] = resetRegistrationNotifications();		}else{			$data["routes"] = array(//array of manager page menu items				"0" => array(					"name" => "new_projects",					"lg" => $data["lg"]["new_projects"],					"url" => url($original_link, "0")				),				"1" => array(					"name" => "trash",					"lg" => $data["lg"]["trash"],					"url" => url($original_link, "1")				),				"2" => array(					"name" => "waiting_approval",					"lg" => $data["lg"]["waiting_approval"],					"url" => url($original_link, "2")				),				"3" => array(					"name" => "needs_employees",					"lg" => $data["lg"]["needs_employees"],					"url" => url($original_link, "3")				),				"4" => array(					"name" => "in_execution",					"lg" => $data["lg"]["in_execution"],					"url" => url($original_link, "4")				),				"5" => array(					"name" => "completed",					"lg" => $data["lg"]["completed"],					"url" => url($original_link, "5"),					"hidden" => true				),				"6" => array(					"name" => "transfered",					"lg" => $data["lg"]["transfered"],					"url" => url($original_link, "6")				),				"7" => array(					"name" => "clients",					"lg" => $data["lg"]["clients"],					"pending" => "0",					"url" => url($original_link, "7")				),				"8" => array(					"name" => "registration_requests",					"lg" => $data["lg"]["registration_requests"],					"pending" => resetRegistrationNotifications(),					"url" => url($original_link, "8")				),				"9" => array(					"name" => "employees",					"lg" => $data["lg"]["employees"],					"url" => url($original_link, "9") ,					"hidden" => true				),/*"http://$_SERVER[HTTP_HOST]" . $data['cat'][0]['long_link'] . "/6"*/			);			//$data["routes"][8]["pending"] = resetRegistrationNotifications();		}	}else{		if(!empty($curr_user[0]["project_manager"])){			if(!empty($curr_user[0]["translator"]) || !empty($curr_user[0]["editor"])){				$data["routes"] = array(//pages for project manager who is also translator/editor					"0" => array(						"name" => "new_projects",						"lg" => $data["lg"]["new_projects"],						"url" => url($original_link, "0")					),					"1" => array(						"name" => "trash",						"lg" => $data["lg"]["trash"],						"url" => url($original_link, "1")					),					"2" => array(						"name" => "waiting_approval",						"lg" => $data["lg"]["waiting_approval"],						"url" => url($original_link, "2")					),					"3" => array(						"name" => "needs_employees",						"lg" => $data["lg"]["needs_employees"],						"url" => url($original_link, "3")					),					"4" => array(						"name" => "in_execution",						"lg" => $data["lg"]["in_execution"],						"url" => url($original_link, "4")					),					"5" => array(						"name" => "completed",						"lg" => $data["lg"]["completed"],						"url" => url($original_link, "5"),						"hidden" => true					),					"6" => array(						"name" => "transfered",						"lg" => $data["lg"]["transfered"],						"url" => url($original_link, "6")					),					"7" => array(						"name" => "new_jobs",						"lg" => $data["lg"]["new_jobs"],						"url" => url($original_link, "7")					),					"8" => array(						"name" => "in_progress",						"lg" => $data["lg"]["in_progress"],						"url" => url($original_link, "8")					),					"9" => array(						"name" => "completed_jobs",						"lg" => $data["lg"]["completed_jobs"],						"url" => url($original_link, "9")					),					"10" => array(						"name" => "declined",						"lg" => $data["lg"]["declined"],						"url" => url($original_link, "10")					)				);			}else{				$data["routes"] = array(//pages for project manager					"0" => array(						"name" => "new_projects",						"lg" => $data["lg"]["new_projects"],						"url" => url($original_link, "0")					),					"1" => array(						"name" => "trash",						"lg" => $data["lg"]["trash"],						"url" => url($original_link, "1")					),					"2" => array(						"name" => "waiting_approval",						"lg" => $data["lg"]["waiting_approval"],						"url" => url($original_link, "2")					),					"3" => array(						"name" => "needs_employees",						"lg" => $data["lg"]["needs_employees"],						"url" => url($original_link, "3")					),					"4" => array(						"name" => "in_execution",						"lg" => $data["lg"]["in_execution"],						"url" => url($original_link, "2")					),					"5" => array(						"name" => "completed",						"lg" => $data["lg"]["completed"],						"url" => url($original_link, "5"),						"hidden" => true					)				);			}		}elseif(!empty($curr_user[0]["translator"]) || !empty($curr_user[0]["editor"])){			$data["routes"] = array(//pages for translators/editors				"0" => array(					"name" => "new_jobs",					"lg" => $data["lg"]["new_jobs"],					"url" => url($original_link, "0")				),				"1" => array(					"name" => "in_progress",					"lg" => $data["lg"]["in_progress"],					"url" => url($original_link, "1")				),				"2" => array(					"name" => "completed_jobs",					"lg" => $data["lg"]["completed_jobs"],					"url" => url($original_link, "2")				),				"3" => array(					"name" => "declined",					"lg" => $data["lg"]["declined"],					"url" => url($original_link, "3")				)			);		}elseif(!empty($curr_user[0]["client"])){			$data["routes"] = array(//pages for clients				"0" => array(					"name" => "submit_work",					"lg" => $data["lg"]["submit_work"],					"url" => url($original_link, "0")				),				"1" => array(					"name" => "submitted_projects",					"lg" => $data["lg"]["submitted_projects"],					"url" => url($original_link, "1")				),				"2" => array(					"name" => "approve_price",					"lg" => $data["lg"]["approve_price"],					"url" => url($original_link, "2")				),				"3" => array(					"name" => "in_execution",					"lg" => $data["lg"]["in_execution"],					"url" => url($original_link, "3")				),				"4" => array(					"name" => "trash",					"lg" => $data["lg"]["trash"],					"url" => url($original_link, "4")				)			);		}	}	$link_post = false;	if(!empty($_POST)){		if( parse_url($_SERVER['HTTP_REFERER'], PHP_URL_HOST) === $_SERVER['HTTP_HOST'] ){			if(!empty($_POST["link"])){				$link_post = $_POST["link"];			}		}	}	$lin1 = get_arg(1, $link_post);//last part of link	$lin2 = get_arg(2, $link_post);//2nd part from the end of link	$lin3 = get_arg(3, $link_post);//3rd part from the end of link	$curr_arr = array_keys($data["routes"]);	if($lin1 == $original_link){//if no route given, then we redirect to fyrstr route		$page = $curr_arr[0];	}else if((is_numeric($lin1)) && (!is_numeric($lin2))){		$page = $lin1;	}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (!is_numeric($lin3))){		$page = $lin2;	}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (is_numeric($lin3))){		$page = $lin3;	}	$data["manager"]["route"] = $data["routes"][$page];	$data["manager"]["route"]["file"] = "./logged_in/" . $data["routes"][$page]["name"] . ".html";	$data["manager"]["curr_page"] = $page;	/* ==================================================== */	$data["manager"]["user"] = $curr_user[0];	//out($data["manager"]);	/* ==================================================== */	if (!empty($data["manager"]["route"]["name"]) && ($data["manager"]["route"]["name"] != "profile")) {		unset($_SESSION["profile_errors"]);	}    $endpg = url_last_part();//get last link piece	if (!empty($data["manager"]["route"]["name"])){		switch ($data["manager"]["route"]["name"]) {			case "submitted_projects":				$page = false;				$limit = false;				getPageLimit($page, $limit, $_POST);				if(!is_numeric($lin1)){ 					header("Location: http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]"."/0");				}else if((is_numeric($lin1)) && (!is_numeric($lin2))){					$data["manager"]["jobs"] = getJobs("0", $data["lg"], $_SESSION["user"]["id"], false, 0, $page, $limit);					$data["manager"]["paginator_info"] = getPaginatorInfo($data["manager"]["jobs"]["total_count"]);				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (!is_numeric($lin3))){						one_back();				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (is_numeric($lin3))){						one_back();				}				break;						case "approve_price":				$page = false;				$limit = false;				getPageLimit($page, $limit, $_POST);				if(!is_numeric($lin1)){ 					header("Location: http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]"."/0");				}else if((is_numeric($lin1)) && (!is_numeric($lin2))){					$data["manager"]["jobs"] = getJobs("1", $data["lg"], $_SESSION["user"]["id"], false, 0, $page, $limit);					$data["manager"]["paginator_info"] = getPaginatorInfo($data["manager"]["jobs"]["total_count"]);				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (!is_numeric($lin3))){						one_back();				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (is_numeric($lin3))){						one_back();				}				break;						case "submit_work":				/*meta("S", array("template"=>"language_pair", "parent_id"=>$data["cat"]["0"]["id"]), $data["language_pairs"]);				$count = 0;				foreach ($data["language_pairs"] as $key => $value) {					foreach($data["lang_items"] as $keyy=>$valuee){					}					if($value["language_to_id"] == $data["cat"][0]["id"]){						$data["pair_array"][$count] = $value;						$count++;					}				}*/				break;			case "trash":				$page = false;				$limit = false;				getPageLimit($page, $limit, $_POST);				if(!is_numeric($lin1)){ 					header("Location: http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]"."/0");				}else if((is_numeric($lin1)) && (!is_numeric($lin2))){					if(($_SESSION["user"]["admin"] == 1) || (($_SESSION["user"]["admin"] == 2) && ($_SESSION["user"]["manager"] == 1))){						$data["manager"]["jobs"] = getJobs("-2", $data["lg"], 0, false, 0, $page, $limit);						$data["manager"]["paginator_info"] = getPaginatorInfo($data["manager"]["jobs"]["total_count"]);					}elseif($_SESSION["user"]["admin"] == 0){						if(!empty($_SESSION["user"]["project_manager"])){							if($_SESSION["user"]["project_manager"] == "1"){								$data["manager"]["jobs"] = getJobs("-2", $data["lg"], 0, false, 0, $page, $limit);								$data["manager"]["paginator_info"] = getPaginatorInfo($data["manager"]["jobs"]["total_count"]);							}						}						if(!empty($_SESSION["user"]["client"])){							if($_SESSION["user"]["client"] == "1"){								$data["manager"]["jobs"] = getJobs("-1", $data["lg"], $_SESSION["user"]["id"], false, 0, $page, $limit);								$data["manager"]["paginator_info"] = getPaginatorInfo($data["manager"]["jobs"]["total_count"]);							}						}					}				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (!is_numeric($lin3))){						one_back();				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (is_numeric($lin3))){						one_back();				}				break;			case "waiting_approval": 				$page = false;				$limit = false;				getPageLimit($page, $limit, $_POST);				if(!is_numeric($lin1)){ 					header("Location: http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]"."/0");				}else if((is_numeric($lin1)) && (!is_numeric($lin2))){					if(($_SESSION["user"]["admin"] == 1) || (($_SESSION["user"]["admin"] == 2) && ($_SESSION["user"]["manager"] == 1))){						$data["manager"]["jobs"] = getJobs(1, $data["lg"], 0, false, 0, $page, $limit);						$data["manager"]["paginator_info"] = getPaginatorInfo($data["manager"]["jobs"]["total_count"]);					}elseif(($_SESSION["user"]["admin"] == 0) && ($_SESSION["user"]["project_manager"] == 1)){						$data["manager"]["jobs"] = getJobs(1, $data["lg"], 0, false, 0, $page, $limit);						$data["manager"]["paginator_info"] = getPaginatorInfo($data["manager"]["jobs"]["total_count"]);					}				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (!is_numeric($lin3))){						one_back();				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (is_numeric($lin3))){						one_back();				}				break;						case "in_progress":				$page = false;				$limit = false;				getPageLimit($page, $limit, $_POST);				if(!is_numeric($lin1)){ 					header("Location: http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]"."/0");				}else if((is_numeric($lin1)) && (!is_numeric($lin2))){					if((!empty($_SESSION["user"]["editor"])) || (!empty($_SESSION["user"]["translator"]))){						$data["manager"]["job_type"] = "jobs"; 						$data["manager"]["single_job"] = false;						$data["manager"]["jobs"] = getIndividualJobs(1,  $_SESSION["user"]["id"], 0, 0);					}else{						one_back();					}				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (!is_numeric($lin3))){					if((!empty($_SESSION["user"]["editor"])) || (!empty($_SESSION["user"]["translator"]))){						$data["manager"]["job_type"] = "jobs"; 						$data["manager"]["single_job"] = true;						$data["manager"]["jobs"] = getIndividualJobs(1,  $_SESSION["user"]["id"], 0, $lin1);					}else{						one_back();					}				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (is_numeric($lin3))){						one_back();				}				break;							case "declined":				$page = false;				$limit = false;				getPageLimit($page, $limit, $_POST);				if(!is_numeric($lin1)){ 					header("Location: http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]"."/0");				}else if((is_numeric($lin1)) && (!is_numeric($lin2))){					if((!empty($_SESSION["user"]["editor"])) || (!empty($_SESSION["user"]["translator"]))){						$data["manager"]["job_type"] = "jobs"; 						$data["manager"]["single_job"] = false;						$data["manager"]["jobs"] = getIndividualJobs(-1,  $_SESSION["user"]["id"], 0, 0);					}else{						one_back();					}				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (!is_numeric($lin3))){					/*if((!empty($_SESSION["user"]["editor"])) || (!empty($_SESSION["user"]["translator"]))){						$data["manager"]["job_type"] = "jobs"; 						$data["manager"]["single_job"] = true;						$data["manager"]["jobs"] = getIndividualJobs(1,  $_SESSION["user"]["id"], 0, $lin1);					}else{*/						one_back();					//}				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (is_numeric($lin3))){						one_back();				}				break;							case "in_execution":				$page = false;				$limit = false;				getPageLimit($page, $limit, $_POST);				if(!is_numeric($lin1)){ 					header("Location: http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]"."/0");				}else if((is_numeric($lin1)) && (!is_numeric($lin2))){					if($_SESSION["user"]["admin"] == 1){						$data["manager"]["job_type"] = "projects"; 						$data["manager"]["jobs"] = getJobs(/*array(2,3,4)*/array(4,5), $data["lg"], 0, true, 0, $page, $limit);//accepted, language, submitter_id, if status about assigned employees on files needed						$data["manager"]["paginator_info"] = getPaginatorInfo($data["manager"]["jobs"]["total_count"]);					}elseif(($_SESSION["user"]["admin"] == 2) && (!empty($_SESSION["user"]["manager"]))){						if($_SESSION["user"]["manager"] == 1){							$data["manager"]["job_type"] = "projects"; 							$data["manager"]["jobs"] = getJobs(array(4,5), $data["lg"], 0, true, 0, $page, $limit);							$data["manager"]["paginator_info"] = getPaginatorInfo($data["manager"]["jobs"]["total_count"]);						}else{							one_back();							}					}elseif(($_SESSION["user"]["admin"] == 0) && ($_SESSION["user"]["client"] == 1)){						$data["manager"]["job_type"] = "projects"; 						$data["manager"]["jobs"] = getJobs(array(4,5), $data["lg"], $_SESSION["user"]["id"], false, 0, $page, $limit);						$data["manager"]["paginator_info"] = getPaginatorInfo($data["manager"]["jobs"]["total_count"]);					}else{						one_back();					}				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (!is_numeric($lin3))){					one_back();				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (is_numeric($lin3))){					one_back();				}				break;						case "completed_jobs":				$page = false;				$limit = false;				getPageLimit($page, $limit, $_POST);				if(!is_numeric($lin1)){ 					header("Location: http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]"."/0");				}else if((is_numeric($lin1)) && (!is_numeric($lin2))){					if((!empty($_SESSION["user"]["editor"])) || (!empty($_SESSION["user"]["translator"]))){						$data["manager"]["jobs"] = getIndividualJobs(1,  $_SESSION["user"]["id"], 1, 0);					}else{						one_back();					}				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (!is_numeric($lin3))){					one_back();				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (is_numeric($lin3))){						one_back();				}				break;							case "transfered":				$page = false;				$limit = false;				getPageLimit($page, $limit, $_POST);				if(!is_numeric($lin1)){ 					header("Location: http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]"."/0");				}else if((is_numeric($lin1)) && (!is_numeric($lin2))){					if($_SESSION["user"]["admin"] == 1){						$data["manager"]["job_type"] = "projects"; 						$data["manager"]["jobs"] = getJobs(6, $data["lg"], 0, true, 1, $page, $limit);						$data["manager"]["paginator_info"] = getPaginatorInfo($data["manager"]["jobs"]["total_count"]);						//accepted, language, submitter_id, if status about assigned employees on files needed					}elseif(($_SESSION["user"]["admin"] == 2) && (!empty($_SESSION["user"]["manager"]))){						if($_SESSION["user"]["manager"] == 1){							$data["manager"]["job_type"] = "projects"; 							$data["manager"]["jobs"] = getJobs(6, $data["lg"], 0, true, 1, $page, $limit);							$data["manager"]["paginator_info"] = getPaginatorInfo($data["manager"]["jobs"]["total_count"]);						}else{							one_back();							}					}else{						one_back();					}				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (!is_numeric($lin3))){					one_back();				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (is_numeric($lin3))){					one_back();				}				break;							case "needs_employees":				$page = false;				$limit = false;				getPageLimit($page, $limit, $_POST);				if(!is_numeric($lin1)){ 					header("Location: http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]"."/0");				}else if((is_numeric($lin1)) && (!is_numeric($lin2))){					$data["manager"]["select_translators"] = true;					if($_SESSION["user"]["admin"] == 1){						$data["manager"]["jobs"] = getJobs(array(2,3), $data["lg"], 0, true, 0, $page, $limit);						$data["manager"]["paginator_info"] = getPaginatorInfo($data["manager"]["jobs"]["total_count"]);					}elseif(($_SESSION["user"]["admin"] == 2) && !empty($_SESSION["user"]["manager"])){						if($_SESSION["user"]["manager"] == 1){							$data["manager"]["jobs"] = getJobs(array(2,3), $data["lg"], 0, true, 0, $page, $limit);							$data["manager"]["paginator_info"] = getPaginatorInfo($data["manager"]["jobs"]["total_count"]);						}else{							one_back();						}					}elseif(($_SESSION["user"]["admin"] == 0) && !empty($_SESSION["user"]["project_manager"])){						if($_SESSION["user"]["project_manager"] == 1){							$data["manager"]["jobs"] = getJobs(array(2,3), $data["lg"], 0, true, 0, $page, $limit);							$data["manager"]["paginator_info"] = getPaginatorInfo($data["manager"]["jobs"]["total_count"]);						}else{							one_back();						}					}else{						one_back();					}				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (!is_numeric($lin3))){						one_back();				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (is_numeric($lin3))){						one_back();				}				break;							case "completed":				$page = false;				$limit = false;				getPageLimit($page, $limit, $_POST);				if(!is_numeric($lin1)){ 					header("Location: http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]"."/0");				}else if((is_numeric($lin1)) && (!is_numeric($lin2))){					$data["manager"]["select_translators"] = true;					if($_SESSION["user"]["admin"] == 1){						$data["manager"]["jobs"] = getJobs(6, $data["lg"], 0, true, 0, $page, $limit);						$data["manager"]["paginator_info"] = getPaginatorInfo($data["manager"]["jobs"]["total_count"]);					}elseif(($_SESSION["user"]["admin"] == 2) && !empty($_SESSION["user"]["manager"])){						if($_SESSION["user"]["manager"] == 1){							$data["manager"]["jobs"] = getJobs(6, $data["lg"], 0, true, 0, $page, $limit);							$data["manager"]["paginator_info"] = getPaginatorInfo($data["manager"]["jobs"]["total_count"]);						}else{							one_back();						}					}elseif(($_SESSION["user"]["admin"] == 0) && !empty($_SESSION["user"]["project_manager"])){						if($_SESSION["user"]["project_manager"] == 1){							$data["manager"]["jobs"] = getJobs(6, $data["lg"], 0, true, 0, $page, $limit);							$data["manager"]["paginator_info"] = getPaginatorInfo($data["manager"]["jobs"]["total_count"]);						}else{							one_back();						}					}else{						one_back();					}				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (!is_numeric($lin3))){						one_back();				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (is_numeric($lin3))){						one_back();				}				break;							case "new_projects":				$page = false;				$limit = false;				getPageLimit($page, $limit, $_POST);				if(!is_numeric($lin1)){ 					header("Location: http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]"."/0");				}else if((is_numeric($lin1)) && (!is_numeric($lin2))){					if(($_SESSION["user"]["admin"] == 1) || (($_SESSION["user"]["admin"] == 2) && ($_SESSION["user"]["manager"] == 1))){						$data["manager"]["jobs"] = getJobs(0, $data["lg"], 0, false, 0, $page, $limit);						$data["manager"]["paginator_info"] = getPaginatorInfo($data["manager"]["jobs"]["total_count"]);					}elseif(($_SESSION["user"]["admin"] == 0) && ($_SESSION["user"]["project_manager"] == 1)){						$data["manager"]["jobs"] = getJobs(0, $data["lg"], 0, false, 0, $page, $limit);						$data["manager"]["paginator_info"] = getPaginatorInfo($data["manager"]["jobs"]["total_count"]);					}				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (!is_numeric($lin3))){						one_back();				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (is_numeric($lin3))){						one_back();				}								break;			case "new_jobs":				$page = false;				$limit = false;				getPageLimit($page, $limit, $_POST);				if(!is_numeric($lin1)){ 					header("Location: http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]"."/0");				}else if((is_numeric($lin1)) && (!is_numeric($lin2))){					if((!empty($_SESSION["user"]["editor"])) || (!empty($_SESSION["user"]["translator"]))){						$data["manager"]["jobs"] = getIndividualJobs(0,  $_SESSION["user"]["id"], 0, 0);					}else{						one_back();					}				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (!is_numeric($lin3))){						one_back();				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (is_numeric($lin3))){						one_back();				}								break;							case "profile": 				break;			case "registration_requests":				$page = false;				$limit = false;				getPageLimit($page, $limit, $_POST);				get_user("S", array("active"=>"0", "admin"=>"0"), $pending_users);				if(!empty($pending_users)){					foreach ($pending_users as $key => $value) {						if(empty($value["denied"]) || $value["denied"] == 0){							$data["manager"]["pending_users"][] = $value;						}					}				}				break;			case "clients":				$page = false;				$limit = false;				getPageLimit($page, $limit, $_POST);				//$limit_str = (($page-1)*$limit).", ".$limit;				$clients = array();				get_user("S", array("active"=>"1", "admin"=>"0"), $new_clients);				foreach ($new_clients as $key => $value) {					if(isset($value["client"])){						if($value["client"] == 1){							$clients[] = $value;						}					}				}				if(!empty($clients)){					$data["manager"]["clients"] = array_slice($clients, (($page-1)*$limit), $limit);					$data["manager"]["paginator_info"]["total"] = count($clients);					$data["manager"]["paginator_info"]["page"] = $page;					$data["manager"]["paginator_info"]["limit"] = $limit;					$data["manager"]["paginator_info"]["page_count"] = ceil(count($clients) / $limit);				}				break;			case "employees":				$page = false;				$limit = false;				getPageLimit($page, $limit, $_POST);				if(empty($_POST["tr"]) && empty($_POST["ed"]) && empty($_POST["pr"])){					$_POST["get_all_employees"] = true;				}else{					$_POST["get_all_employees"] = false;					if(empty($_POST["tr"])){						$_POST["tr"] = false;					}					if(empty($_POST["ed"])){						$_POST["ed"] = false;					}					if(empty($_POST["pr"])){						$_POST["pr"] = false;					}				}				if((is_numeric($lin1)) && (!is_numeric($lin2))){ 					header("Location: http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]"."/0");				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (!is_numeric($lin3))){					if($lin1 == 0){						if($_POST["get_all_employees"]){							$data["manager"]["translators"] = get_employees(false,false,false,true);							$data["manager"]["all_selected"] = true;							$data["manager"]["curr_page"] = 0;						}else{							$data["manager"]["translators"] = get_employees($_POST["tr"],$_POST["ed"],$_POST["pr"],false);							$data["manager"]["tr"] = $_POST["tr"];							$data["manager"]["ed"] = $_POST["ed"];							$data["manager"]["pr"] = $_POST["pr"];							$data["manager"]["curr_page"] = 0;						}					}else if($lin1 == 1){						$data["manager"]["translators"] = "NEW";						$data["manager"]["curr_page"] = 1;					}				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (is_numeric($lin3))){					if($lin2 == 0){						get_user("S", array("active"=>"1", "admin"=>"0", "id"=>$lin1), $employee);						if(!empty($employee)){							if((!empty($employee[0]["translator"])) || (!empty($employee[0]["editor"])) || (!empty($employee[0]["project_manager"]))){								$data["manager"]["employee"] = $employee[0];//get employee data								$query = "SELECT * FROM employee_language_pairs WHERE employee_id=\"" . $data["manager"]["employee"]["id"] . "\"";//get all language pairs of employee							    $rs= mysql_query($query);							    $employee_pears = getSqlRows($rs);//yes, pears							    meta("S", array("template"=>"expertise_item"), $data["manager"]["expertise_items"]);//get all specialities							    foreach ($employee_pears as $key => $value) {							    	$query = "SELECT * FROM language_pair_specialities WHERE pair_id=\"" . $value["id"] . "\"";//get all specialities of employee language pair								    $rez= mysql_query($query);								    $specialities = getSqlRows($rez);//yes, pears								    if(!empty($specialities)){								    	$employee_pears[$key]["specialities"] = array();								    	$employee_pears[$key]["specialities"] = $specialities;								    }							    }								meta("S", array("template"=>"language_pair"), $data["manager"]["language_pairs"]);//get all language pairs								if(!empty($employee_pears) && !empty($data["manager"]["language_pairs"])){									foreach ($employee_pears as $key => $value) {										foreach ($data["manager"]["language_pairs"] as $keyy => $valuee) {											if($valuee["id"] == $value["pair_id"]){												unset($data["manager"]["language_pairs"][$keyy]);//remove language pairs from complete list if the employee possesses them												$valuee["when_learned"] = $value["when_learned"];												$valuee["rate"] = $value["rate"];												$valuee["currency"] = $value["currency"];												$valuee["employee_pair_id"] = $value["id"];												if(!empty($value["specialities"])){													$valuee["pair_specialities"] = $value["specialities"];												}												$data["manager"]["employee"]["language_pairs"][] = $valuee;//add language pair to employee laguage pair array which he possesses												break;											}										}									}								}								$data["manager"]["translators"] = "PROFILE";								$data["manager"]["curr_page"] = 2;							}else{								one_back();//if we should not reach this user through this page then we are set back one page							}							$data["currencies"] = getCurrencies($settings["vacancy_form_currencies"]);						}else{							one_back();						}											}else if($lin2 == 1){						$data["manager"]["translators"] = "NEW";						$data["manager"]["curr_page"] = 1;					}				}				$_POST = array();				break;							case "project_manager":				$page = false;				$limit = false;				getPageLimit($page, $limit, $_POST);				if((is_numeric($lin1)) && (!is_numeric($lin2))){ 					header("Location: http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]"."/0");				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (!is_numeric($lin3))){					if($lin1 == 0){						$data["manager"]["project_managers"] = get_project_managers();						$data["manager"]["curr_page"] = 0;					}else if($lin1 == 1){						$data["manager"]["project_managers"] = "NEW";						$data["manager"]["curr_page"] = 1;					}				}else if(((is_numeric($lin1))) && (is_numeric($lin2)) && (is_numeric($lin3))){					if($lin2 == 0){						get_user("S", array("active"=>"1", "admin"=>"0", "id"=>$lin1), $employee);						if(!empty($employee)){							if((!empty($employee[0]["translator"])) || (!empty($employee[0]["editor"])) || (!empty($employee[0]["project_manager"]))){								$data["manager"]["employee"] = $employee[0];//get employee data								$query = "SELECT * FROM employee_language_pairs WHERE employee_id=\"" . $data["manager"]["employee"]["id"] . "\"";//get all language pairs of employee							    $rs= mysql_query($query);							    $employee_pears = getSqlRows($rs);//yes, pears							    meta("S", array("template"=>"expertise_item"), $data["manager"]["expertise_items"]);//get all specialities							    foreach ($employee_pears as $key => $value) {							    	$query = "SELECT * FROM language_pair_specialities WHERE pair_id=\"" . $value["id"] . "\"";//get all specialities of employee language pair								    $rez= mysql_query($query);								    $specialities = getSqlRows($rez);//yes, pears								    if(!empty($specialities)){								    	$employee_pears[$key]["specialities"] = array();								    	$employee_pears[$key]["specialities"] = $specialities;								    }							    }								meta("S", array("template"=>"language_pair"), $data["manager"]["language_pairs"]);//get all language pairs								if(!empty($employee_pears) && !empty($data["manager"]["language_pairs"])){									foreach ($employee_pears as $key => $value) {										foreach ($data["manager"]["language_pairs"] as $keyy => $valuee) {											if($valuee["id"] == $value["pair_id"]){												unset($data["manager"]["language_pairs"][$keyy]);//remove language pairs from complete list if the employee possesses them												$valuee["when_learned"] = $value["when_learned"];												$valuee["rate"] = $value["rate"];												$valuee["currency"] = $value["currency"];												$valuee["employee_pair_id"] = $value["id"];												if(!empty($value["specialities"])){													$valuee["pair_specialities"] = $value["specialities"];												}												$data["manager"]["employee"]["language_pairs"][] = $valuee;//add language pair to employee laguage pair array which he possesses												break;											}										}									}								}								$data["manager"]["translators"] = "PROFILE";								$data["manager"]["curr_page"] = 2;							}else{								one_back();//if we should not reach this user through this page then we are set back one page							}							$data["currencies"] = getCurrencies($settings["vacancy_form_currencies"]);						}else{							one_back();						}											}else if($lin2 == 1){						$data["manager"]["translators"] = "NEW";						$data["manager"]["curr_page"] = 1;					}				}				break;			case "exit": 				header("Location: /logout.php");				exit();				break;						default:				# code...				break;		}	}	/* ==================================================== */	/*function upload($file) {		global $id, $database, $database_prefix;		if (empty($file["tmp_name"])) {			$file["tmp_name"] = $file["name"];		}		$ext = end(explode(".", $file["name"]));		$hash = sha1(uniqid());		$path = $_SERVER['DOCUMENT_ROOT'] . "/images/users/$hash.$ext";		if ($file["size"] > 4000000) {			$_SESSION["profile_errors"]["image"] = true;			return;		}		$database->update($database_prefix . "users", array(			"image" => $hash . ".$ext"		), array(			"id" => $_SESSION["user"]["id"]		));		//stop		move_uploaded_file($file["tmp_name"], $path);	}*/	function refresh() {		header("Location: http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]");		exit();	}	function is_action($try) {		if (! isset($_POST)) {			return false;		}		return isset($_POST["action"]) ?			$_POST["action"] == $try : false;	}	function get_user_id() {		return $_SESSION["user"]["id"];	}	function get_page() {		return get_arg(1);//get id for the notices page 	}	function get_arg($i, $link) {		if(!empty($link)){			$expl = explode("/", $link);//gets all user information			//out($expl);			//out(sizeof($expl));			if((!empty($expl[sizeof($expl) - $i])) || (isset($expl[sizeof($expl) - $i]))){				return $expl[sizeof($expl) - $i];//takes needed info from user infromation			}else{				return false;			}		}else{			if(!empty($_GET["variables"])){				$expl = explode("/", $_GET["variables"]);//gets all user information				//out($expl);				//out(sizeof($expl));				if((!empty($expl[sizeof($expl) - $i])) || (isset($expl[sizeof($expl) - $i]))){					return $expl[sizeof($expl) - $i];//takes needed info from user infromation				}else{					return false;				}			}else{				return false;			}		}	}	function one_back(){		$new_link = explode("/", "http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]");		array_pop ( $new_link );		$new_link = implode("/", $new_link);		header("Location: $new_link");	}	function get_employees($tr,$ed,$pr,$all){		get_user("S", array("active"=>"1", "admin"=>"0"), $employees);		$employees_arr = array();		//$to_get = 0;       for AND logic when selecting employees  		//if($tr)$to_get++;		//if($ed)$to_get++;		//if($pr)$to_get++;		foreach ($employees as $key => $value) {			$curr_cou = 0;			if($all == true){				if(!empty($value["translator"])){					if($value["translator"]=="1"){						$employees_arr[] = $value;					}				}elseif(!empty($value["editor"])){					if($value["editor"]=="1"){						$employees_arr[] = $value;					}				}elseif(!empty($value["project_manager"])){					if($value["project_manager"]=="1"){						$employees_arr[] = $value;					}				}			}else{				if($tr == true){					if(isset($value["translator"])){						if($value["translator"]=="1"){							$employees_arr[] = $value;							continue;							//$curr_cou++;						}					}				}				if($ed == true){					if(isset($value["editor"])){						if($value["editor"]=="1"){							$employees_arr[] = $value;							continue;							//$curr_cou++;						}					}				}				if($pr == true){					if(isset($value["project_manager"])){						if($value["project_manager"]=="1"){							$employees_arr[] = $value;							//$curr_cou++;						}					}				}				/*if($curr_cou == $to_get){//for AND logic					$employees_arr[] = $value;				}*/			}		}		return $employees_arr;	}	function get_translators_editors(){		get_user("S", array("active"=>"1", "admin"=>"0"), $translators);		$translators_arr = array();		foreach ($translators as $key => $value) {			if(isset($value["translator"])){				if($value["translator"] == "1"){					$translators_arr[] = $value;				}else if(isset($value["editor"])){					if($value["editor"] == "1"){						$translators_arr[] = $value;					}				}			}else if(isset($value["editor"])){				if($value["editor"] == "1"){					$translators_arr[] = $value;				}			}		}		return $translators_arr;	}	function get_project_managers(){		get_user("S", array("active"=>"1", "admin"=>"0"), $project_managers);		$managers_arr = array();		foreach ($project_managers as $key => $value) {			if(isset($value["project_manager"])){				if($value["project_manager"] == "1"){					$managers_arr[] = $value;				}			}		}		return $managers_arr;	}	function url($original_link, $pag_substr) {//gets url for the menu items		$url = rtrim("http://$_SERVER[HTTP_HOST]/$original_link", "/");		$pieces = explode("/", $url);		if($pieces[sizeof($pieces) - 1] == $original_link){			array_push($pieces, $pag_substr);		}else{			for($i = 0; $i < sizeof($pieces); $i++){				if(is_numeric($pieces[sizeof($pieces) - i])){					unset($pieces[sizeof($pieces) - i]);				}			}			array_push($pieces, $pag_substr);		}		return implode("/", $pieces);	}	function url_last_part(){//get last part of url and add "/"	global $data;		$link = "http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]";		$link_array = explode('/',$link);		$url_end = end($link_array);		$url_end = "/$url_end";		return $url_end;	}		function getJobs($accepted, $lang, $submitter, $file_employee_status, $clientCanSee, $page, $limit){		//file_employee_status:		/*		state: 1 - assigned employee info needed		*/		/*		$requests = array();	    $rs= mysql_query($query);	    if(mysql_num_rows($rs) > 0){		    while($row = mysql_fetch_assoc($rs))			{				$requests[] = $row;				//out($row);			}		}			//out($requests);	    $this->_total = count($requests);		*/		// $last       = ceil( $this->_total / $this->_limit );		$canSeePart = "";		if(!empty($clientCanSee)){			$canSeePart = " AND (let_customer_see='1')";		}		$limit_page = "";		if($page != false && $limit != false){//pagination			$limit_page = " LIMIT ".(($page-1)*$limit).", ".$limit;		}		if(!empty($submitter)){			if(is_array($accepted)){				$query_part = "";				$count = 0;				foreach($accepted as $acc_key=>$acc_item){					if($count > 0){						$query_part .=  " OR (accepted='".$acc_item."')";					}else{						$query_part .= "((accepted='".$acc_item."')";					}					$count++;				}				$query_part .= ")";				//var_dump($query_part);				//exit();				$query = "SELECT * FROM submitted_work WHERE $query_part AND (user_id='$submitter')$canSeePart ORDER BY created DESC$limit_page";//get all specialities of employee language pair				//var_dump($query);				$rez= mysql_query($query);				$jobs = getSqlRows($rez);				$jobs["total_count"] = array();				if($limit_page != ""){//getting total number of these jobs for pagination					$query = "SELECT id FROM submitted_work WHERE $query_part AND (user_id='$submitter')$canSeePart";//get all specialities of employee language pair					//var_dump($query);					$rez= mysql_query($query);					$jobs_count = getSqlRows($rez);					$jobs["total_count"]["total"] = count($jobs_count);					$jobs["total_count"]["page"] = $page;					$jobs["total_count"]["limit"] = $limit;					$jobs["total_count"]["page_count"] = ceil(count($jobs_count) / $limit);				}			}else{				$query = "SELECT * FROM submitted_work WHERE (accepted='$accepted') AND (user_id='$submitter')$canSeePart ORDER BY created DESC$limit_page";//get all specialities of employee language pair				$rez= mysql_query($query);				$jobs = getSqlRows($rez);				$jobs["total_count"] = array();				if($limit_page != ""){//getting total number of these jobs for pagination					$query = "SELECT id FROM submitted_work WHERE (accepted='$accepted') AND (user_id='$submitter')$canSeePart";//get all specialities of employee language pair					//var_dump($query);					$rez= mysql_query($query);					$jobs_count = getSqlRows($rez);					$jobs["total_count"]["total"] = count($jobs_count);					$jobs["total_count"]["page"] = $page;					$jobs["total_count"]["limit"] = $limit;					$jobs["total_count"]["page_count"] = ceil(count($jobs_count) / $limit);				}			}		}else{			if(is_array($accepted)){				$query_part = "";				$count = 0;				foreach($accepted as $acc_key=>$acc_item){					if($count > 0){						$query_part .=  " OR (accepted='".$acc_item."')";					}else{						$query_part .= "((accepted='".$acc_item."')";					}					$count++;				}				$query_part .= ")";				//var_dump($query_part);				//exit();				$query = "SELECT * FROM submitted_work WHERE $query_part$canSeePart ORDER BY created DESC$limit_page";//get all specialities of employee language pair				//var_dump($submitter);				$rez= mysql_query($query);				$jobs = getSqlRows($rez);				$jobs["total_count"] = array();				if($limit_page != ""){//getting total number of these jobs for pagination					$query = "SELECT id FROM submitted_work WHERE $query_part$canSeePart";//get all specialities of employee language pair					//var_dump($query);					$rez= mysql_query($query);					$jobs_count = getSqlRows($rez);					$jobs["total_count"]["total"] = count($jobs_count);					$jobs["total_count"]["page"] = $page;					$jobs["total_count"]["limit"] = $limit;					$jobs["total_count"]["page_count"] = ceil(count($jobs_count) / $limit);				}			}else{				$query = "SELECT * FROM submitted_work WHERE accepted='$accepted'$canSeePart ORDER BY created DESC$limit_page";//get all specialities of employee language pair				$rez= mysql_query($query);				$jobs = getSqlRows($rez);				$jobs["total_count"] = array();				if($limit_page != ""){//getting total number of these jobs for pagination					$query = "SELECT id FROM submitted_work WHERE accepted='$accepted'$canSeePart";//get all specialities of employee language pair					//var_dump($query);					$rez= mysql_query($query);					$jobs_count = getSqlRows($rez);					$jobs["total_count"]["total"] = count($jobs_count);					$jobs["total_count"]["page"] = $page;					$jobs["total_count"]["limit"] = $limit;					$jobs["total_count"]["page_count"] = ceil(count($jobs_count) / $limit);				}			}		}		if(!empty($jobs)){			foreach($jobs as $key=>$value){				if(!empty($value["user_id"])){					$customer = array();					get_user("S", array("admin"=>"0", "id"=>$value["user_id"]), $customer);					if(!empty($customer)){						$jobs[$key]["customer"] = $customer;						$query = "SELECT * FROM submitted_pairs WHERE work_id = '" . $value["id"] . "'";						$res = mysql_query($query);						$pairs = getSqlRows($res);						if(!empty($pairs)){							$total_file_count = 0;							foreach($pairs as $pair_key=>$pair_value){								if(is_numeric($pair_value["lang_from"]) && is_numeric($pair_value["lang_to"])){																		/********************getting original language pair id**************************/									$pairs[$pair_key]["language_pair_original"] = getOriginalPair($pair_value["lang_from"], $pair_value["lang_to"]);									/***************************************************************************************/																		/***********************getting language pair names*****************************/									meta("S", array("template"=>"language", "id"=>$pair_value["lang_from"]), $language_from);									if(!empty($language_from)){										$pairs[$pair_key]["lang_from_name"] = $language_from[0]["name"];									}									meta("S", array("template"=>"language", "id"=>$pair_value["lang_to"]), $language_to);									if(!empty($language_to)){										$pairs[$pair_key]["lang_to_name"] = $language_to[0]["name"];									}									/**************************************************************************************/																		/***********************getting language pair files*****************************/									$query = "SELECT * FROM submitted_files WHERE (pair_id = '" . $pair_value["id"] . "') AND (work_id = '" . $value["id"] . "')";									$res = mysql_query($query);									$pair_files = getSqlRows($res);									if(!empty($pair_files)){										foreach($pair_files as $file_key=>$file_value){											$pair_files[$file_key]["file_path"] = getFileLink("images", $pair_files[$file_key]["file_path"]);											if(!empty($file_value["speciality_id"])){												$query = "SELECT * FROM language_pair_prices WHERE (id = '" . $file_value["speciality_id"] . "')";												$res = mysql_query($query);												$speciality = getSqlRows($res);												if(!empty($speciality)){													meta("S", array("template"=>"expertise_item", "id"=> $speciality[0]["speciality"]), $expertises);													if(!empty($expertises)){														$expertises[0]["rate"] = $speciality[0]["rate"];														$pair_files[$file_key]["speciality"] = $expertises[0];													}												}											}											if(!empty($file_employee_status)){												if($file_employee_status){//if info needed if file has an employee assigned													$query = "SELECT * FROM appointed_employees WHERE (file_id = '" . $file_value["id"] . "') AND (work_id = '" . $value["id"] . "')" AND "((accepted = '0') OR (accepted='-1'))";													$res = mysql_query($query);													$file_translators = getSqlRows($res);													if(!empty($file_translators)){														$pair_files[$file_key]["has_employee"] = true;														if(isset($file_value["word_count"])){															if(!empty($file_value["word_count"])){																$word_count = 0;																$all_filled = false;																foreach($file_translators as $tr_key=>$tr_val){//count all the involved translators word count																	if($tr_val["accepted"] == 1){																		$word_count += $tr_val["word_count"];																	}																}																if($file_value["word_count"] == $word_count){																	$all_filled = true;																	$pair_files[$file_key]["all_assigned"] = true;																}																foreach($file_translators as $tr_key=>$tr_val){//count all the involved translators word count																	//$word_count += $tr_val["word_count"];																	$employee=array();																	if(($tr_val["accepted"] == "-1" && !$all_filled) || ($tr_val["accepted"] == "0") || ($tr_val["accepted"] == "1")){																		get_user("S", array("id"=>$tr_val["employee_id"]), $employee);																		if(!empty($employee)){																			$file_translators[$tr_key]["file_path"] = getFileLink("images", $tr_val["file_path"]);//convert file path to link																			unset($employee[0]["password"]);																			unset($employee[0]["dr"]);																			unset($employee[0]["fb"]);																			unset($employee[0]["go"]);																			unset($employee[0]["tw"]);																			unset($employee[0]["ln"]);																			unset($employee[0]["last_seen"]);																			unset($employee[0]["soc_id"]);																			unset($employee[0]["soc"]);																			$file_translators[$tr_key]["employee"] = $employee[0];																		}																	}else{																		unset($file_translators[$file_key]);//if all the needed offers were accepted, then we do not show those who were declined																	}																}																$pair_files[$file_key]["appointed_employees"] = $file_translators;															}														}													}else{														$pair_files[$file_key]["has_employee"] = false;													}												}/*elseif($file_employee_status == "2"){//if info needed if file has an employee assigned													$query = "SELECT * FROM appointed_employees WHERE (file_id = '" . $file_value["id"] . "') AND (work_id = '" . $value["id"] . "') AND (accepted = '1')";													$res = mysql_query($query);													$file_translators = getSqlRows($res);													if(!empty($file_translators)){														if(isset($file_value["word_count"])){															if(!empty($file_value["word_count"])){																$word_count = 0;																foreach($file_translators as $tr_key=>$tr_val){//count all the involved translators word count																	$word_count += $tr_val["word_count"];																}																if($word_count == $file_value["word_count"]){																	$pair_files[$file_key]["has_employee"] = true;																	$pair_files[$file_key]["appointed_employees"] = $file_translators;																}else{																	$pair_files[$file_key]["has_employee"] = false;																	unset($jobs[$key]);																}															}else{																$pair_files[$file_key]["has_employee"] = false;																unset($jobs[$key]);															}														}else{															$pair_files[$file_key]["has_employee"] = false;															unset($jobs[$key]);														}													}else{														$pair_files[$file_key]["has_employee"] = false;														unset($jobs[$key]);													}												}*/											}										}										$pairs[$pair_key]["files"] = $pair_files;										$pairs[$pair_key]["file_count"] = count($pair_files);										$total_file_count += count($pair_files);									}									/******************************************************************************************/									//out($pairs[$pair_key]["language_pair_original"]);																		/****getting language pair speciality prices if such a pair even exists****/									if(!empty($pairs[$pair_key]["language_pair_original"])){										$query = "SELECT * FROM language_pair_prices WHERE pair_id='".$pairs[$pair_key]["language_pair_original"]["id"]."'";//get all specialities of employee language pair										$rez= mysql_query($query);										$specialities = getSqlRows($rez);										if(!empty($specialities)){											 meta("S", array("template"=>"expertise_item"), $all_specialities);//get all specialities											 if(!empty($all_specialities)){												 foreach($specialities as $spec_key=>$spec_val){													 foreach($all_specialities as $all_spec_key=>$all_spec_val){														if($spec_val["speciality"] == "regular"){															$specialities[$spec_key]["name"] = $lang["regular"];														}else if($spec_val["speciality"] == $all_spec_val["id"]){															$specialities[$spec_key]["name"] = $all_spec_val["name"];														}													 }												 }												 $pairs[$pair_key]["specialities"] = $specialities;											 }											 //out($pairs[$pair_key]["specialities"]);										}									}									/******************************************************************************************/								}							}							//out($pairs);							$jobs[$key]["pairs"] = $pairs;							$jobs[$key]["file_count"] = $total_file_count;						}					}else{						one_back();					}				}			}			return $jobs;		}	}		function getIndividualJobs($accepted, $employee_id, $completed, $job_id){		$id_search = "";		if(!empty($job_id)){			$id_search = " AND (id='$job_id')";		}		$query = "SELECT * FROM appointed_employees WHERE (employee_id = '" . $employee_id . "') AND (completed = '" . $completed . "') AND (accepted = '$accepted')$id_search";		$res = mysql_query($query);		$jobs = getSqlRows($res);		if(!empty($jobs)){			foreach($jobs as $job_key=>$job_val){				$query = "SELECT * FROM submitted_work WHERE (id = '" . $job_val["work_id"] . "')";//select work details and add to job				$res = mysql_query($query);				$project = getSqlRows($res);				if(!empty($project)){					$jobs[$job_key]["project"] = $project[0];				}				if(!empty($job_val["file_path"])){					$jobs[$job_key]["file_path"] = getFileLink("images", $job_val["file_path"]);				}				$query = "SELECT * FROM submitted_files WHERE (id = '" . $job_val["file_id"] . "')";//select file details and add to job				$res = mysql_query($query);				$file = getSqlRows($res);				if(!empty($file)){					if(!empty($file[0]["speciality_id"])){						$query = "SELECT * FROM language_pair_prices WHERE (id = '" . $file[0]["speciality_id"] . "')";//select agency rates						$res = mysql_query($query);						$speciality = getSqlRows($res);						if(!empty($speciality)){							$file[0]["agency_rate"] = $speciality[0]["rate"];							if($speciality[0]["speciality"] == "regular"){//select employee rate from regular language pair								$query = "SELECT * FROM employee_language_pairs WHERE (pair_id = '" . $speciality[0]["pair_id"] . "') AND (employee_id = '$employee_id')";								$res = mysql_query($query);								$employee_pair = getSqlRows($res);								if(!empty($employee_pair)){									//var_dump($employee_pair);									if(empty($job_val["price"])){										$file[0]["employee_price"] = getPrice($job_val["word_count"], $employee_pair[0]["rate"]);									}									$file[0]["employee_rate"] = $employee_pair[0]["rate"];								}							}else{								meta("S", array("template"=>"expertise_item", "id"=>$speciality[0]["speciality"]), $speciality_name);								if(!empty($speciality_name)){									$file[0]["speciality"] = $speciality_name[0]["name"];								}								$query = "SELECT * FROM employee_language_pairs WHERE (pair_id = '" . $speciality[0]["pair_id"] . "') AND (employee_id = '$employee_id')";								$res = mysql_query($query);								$employee_pair = getSqlRows($res);								if(!empty($employee_pair)){									$speciality_id = $speciality[0]["speciality"];//select employee rate from language pair with speciality									$query = "SELECT * FROM language_pair_specialities WHERE (speciality_id = '" . $speciality_id . "') AND (pair_id='".$employee_pair[0]["id"]."')";									//var_dump($query);									$res = mysql_query($query);									$employee_speciality = getSqlRows($res);									if(!empty($employee_speciality)){										//var_dump($employee_speciality);										$file[0]["employee_price"] = getPrice($job_val["word_count"], $employee_speciality[0]["rate"]);										$file[0]["employee_rate"] = $employee_speciality[0]["rate"];									}								}							}						}					}					$file[0]["file_path"] = getFileLink("images", $file[0]["file_path"]);//convert file path to link					$jobs[$job_key]["file"] = $file[0];										get_user("S", array("id"=>$job_val["assigner_id"]), $assigner);					if(!empty($assigner)){						$jobs[$job_key]["assigner"] = $assigner[0]["name"]." ".$assigner[0]["surname"];					}										$query = "SELECT * FROM submitted_pairs WHERE (id = '" . $file[0]["pair_id"] . "')";					$res = mysql_query($query);					$pair = getSqlRows($res);					if(!empty($pair)){						$lang_from = array();						meta("S", array("template"=>"language", "id"=>$pair[0]["lang_from"]), $lang_from);						$pair[0]["lang_from"] = $lang_from[0]["name"];						$lang_to = array();						meta("S", array("template"=>"language", "id"=>$pair[0]["lang_to"]), $lang_to);						$pair[0]["lang_to"] = $lang_to[0]["name"];						$jobs[$job_key]["pair"] = $pair[0];					}				}			}			return $jobs;		}	}		function getPageLimit(&$page, &$limit, $post){		//var_dump($post);		if(!empty($post["page_nr"])){			$page_nr = intval($post["page_nr"]);			if(is_int($page_nr)){				$page = $page_nr;			}else{				$page = 1;			}		}else{			$page = 1;		}		if(!empty($post["page_limit"])){			$limit_nr = intval($post["page_limit"]);			if(is_int($limit_nr)){				$limit = $limit_nr;			}else{				$limit = 5;			}		}else{			$limit = 5;		}	}		function getPaginatorInfo($paginator_info){		$returnable = array();		if(!empty($paginator_info["total"]) && !empty($paginator_info["page"]) && !empty($paginator_info["limit"]) && !empty($paginator_info["page_count"])){			$returnable["total"] = $paginator_info["total"];			$returnable["page"] = $paginator_info["page"];			$returnable["limit"] = $paginator_info["limit"];			$returnable["page_count"] = $paginator_info["page_count"];		}		return $returnable;	}?>